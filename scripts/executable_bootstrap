#!/usr/bin/env bash
# Bootstrap script for new machine setup

set -e

echo "==> Starting machine bootstrap..."

# ============================================================
# Package Installation
# ============================================================
echo ""
echo "==> Installing packages..."

PACKAGES=(
    claude-code
    tmux
    ghostty
)

sudo pacman -S --needed --noconfirm "${PACKAGES[@]}"

# ============================================================
# SSH Key Setup
# ============================================================
echo ""
echo "==> Setting up SSH key for GitHub..."

SSH_KEY="$HOME/.ssh/github"
if [ ! -f "$SSH_KEY" ]; then
    echo "Generating SSH key pair for GitHub..."
    ssh-keygen -t ed25519 -f "$SSH_KEY" -C "github" -N ""
    echo "SSH key generated at: $SSH_KEY"
    echo "Public key:"
    cat "${SSH_KEY}.pub"
else
    echo "SSH key already exists at: $SSH_KEY"
fi

# ============================================================
# Tmux Plugin Manager Setup
# ============================================================
echo ""
echo "==> Setting up Tmux Plugin Manager (TPM)..."

TPM_DIR="$HOME/.config/tmux/plugins/tpm"
if [ ! -d "$TPM_DIR" ]; then
    echo "Installing TPM..."
    git clone https://github.com/tmux-plugins/tpm "$TPM_DIR"
else
    echo "TPM already installed, updating..."
    git -C "$TPM_DIR" pull
fi

echo "Installing tmux plugins..."
TMUX_PLUGIN_MANAGER_PATH="$HOME/.config/tmux/plugins" "$TPM_DIR/bin/install_plugins"

# ============================================================
# Done
# ============================================================
echo ""
echo "==> Bootstrap complete!"
